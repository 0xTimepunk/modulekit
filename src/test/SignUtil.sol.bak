// SPDX-License-Identifier: MIT
pragma solidity ^0.8.21;

import { UserOperation } from "../external/ERC4337.sol";
import { RhinestoneAccount } from "./RhinestoneModuleKit.sol";

library SignUtil {
    function sign(
        UserOperation memory userOp,
        RhinestoneAccount memory instance,
        bytes memory withSignature,
        address forValidator
    )
        internal
        returns (UserOperation memory)
    {
        uint192 key = uint192(bytes24(bytes20(address(validator))));
        uint256 nonce = instance.aux.entrypoint.getNonce(address(instance.account), key);
        userOp.nonce = nonce;
        userOp.signature = signature;
        return userOp;
    }
}
